// https://github.com/dotnet/templating/wiki/%22Runnable-Project%22-Templates#configuration
{
    "$schema": "http://json.schemastore.org/template",
    "author": "TotalSoft",
    "classifications": [ "NBB", "Worker", "Messaging"],
    "name": "NBB Worker",
    "groupIdentity": "NBB.Worker",
    "identity": "NBB.Worker.CSharp",
    "shortName": "nbbworker",
    "tags": {
      "language": "C#",
      "type": "project"
    },
    "sourceName": "NBB.Worker",
    "preferNameDirectory": true,
    "primaryOutputs": [
      { "path": "NBB.Worker.csproj" }
    ],
    "sources": [
      {
        "exclude": ["PlaceholderTypes/*", ".template.config/*"],
        "modifiers": [
          {
            "condition": "(!HealthCheck)",
            "exclude": [
              "HealthChecks/*"
            ]
          },
          {
            "condition": "(!AspNetApp)",
            "exclude": [
              "Startup.cs",
              "Properties/launchSettings.json"
            ]
          },
          {
            "condition": "(!AddSamples)",
            "exclude": [
              "Messaging/*"
            ]
          }
        ]
      }
    ],
    "symbols": {
      "Title": {
        "type": "parameter",
        "datatype": "string",
        "defaultValue": "Project Title",
        "replaces": "PROJECT-TITLE",
        "description": "The name of the project which determines the assembly product name."
      },
      "TitleXmlEncoded": {
        "type": "derived",
        "replaces": "PROJECT-TITLE-XML",
        "valueSource": "Title",
        "valueTransform": "xmlEncode"
      },
     "Description": {
        "type": "parameter",
        "datatype": "string",
        "defaultValue": "Project Description",
        "replaces": "PROJECT-DESCRIPTION",
        "description": "A description of the project which determines the assembly description."
      },
      "DescriptionXmlEncoded": {
        "type": "derived",
        "replaces": "PROJECT-DESCRIPTION-XML",
        "valueSource": "Description",
        "valueTransform": "xmlEncode"
      },
      "Author": {
        "type": "parameter",
        "datatype": "string",
        "defaultValue": "Project Author",
        "replaces": "PROJECT-AUTHOR",
        "description": "The name of the author of the project which determines the assembly author, company and copyright information."
      },
      "AuthorXmlEncoded": {
        "type": "derived",
        "replaces": "PROJECT-AUTHOR-XML",
        "valueSource": "Author",
        "valueTransform": "xmlEncode"
      },
      "HealthCheck": {
        "type": "parameter",
        "datatype": "bool",
        "defaultValue": "true",
        "description": "A health-check endpoint that returns the status of this service and its dependencies, giving an indication of its health."
      },
      "Resiliency": {
        "type": "parameter",
        "datatype": "bool",
        "defaultValue": "true",
        "description": "Adds default resiliency policy to the messaging host."
      },
      "SqlLogging": {
        "type": "parameter",
        "datatype": "bool",
        "defaultValue": "true",
        "description": "Write logs to a Microsoft Sql Server database."
      },
      "SqlLoggingConnectionString": {
        "type": "parameter",
        "datatype": "string",
        "defaultValue": "Server=SERVER;Database=DATABASE;User Id=USER;Password=PASS;MultipleActiveResultSets=true",
        "replaces": "SQL_LOG_CONNECTION_STRING",
        "description": "The connection string to the sql server database."
      },
      "FluentValidation": {
        "type": "parameter",
        "datatype": "bool",
        "defaultValue": "true",
        "description": "Register fluent validators in IoC container."
      },
      "AutoMapper": {
        "type": "parameter",
        "datatype": "bool",
        "defaultValue": "true",
        "description": "Register AutoMapper profilers in IoC container."
      },
      "MediatR": {
        "type": "parameter",
        "datatype": "bool",
        "defaultValue": "true",
        "description": "Add MediatR support."
      },
      "AddSamples": {
        "type": "parameter",
        "datatype": "bool",
        "defaultValue": "true",
        "description": "Add sample files like a subscriber pipeline middleware or a publisher decorator."
      },
      "MessagingTransport": {
        "type": "parameter",
        "datatype": "choice",
        "choices": [
          {
            "choice": "Nats",
            "description": "Use Nats Messaging transport."
          },
          {
            "choice": "Kafka",
            "description": "Use NATS Messaging transport."
          }
        ],
        "description": "Choose the messaging transport.",
        "isRequired":  true
      },
      "NatsMessagingTransport": {
        "type": "computed",
        "value": "(MessagingTransport == \"Nats\")"
      },
      "KafkaMessagingTransport": {
        "type": "computed",
        "value": "(MessagingTransport == \"Kafka\")"
      },
      "SkipRestore": {
        "type": "parameter",
        "datatype": "bool",
        "description": "Skips the execution of 'dotnet restore' on project creation.",
        "defaultValue": "false"
      },
      "LocalNBB": {
        "type": "computed",
        "value": "false"
      },

      "AspNetApp": {
        "type": "computed",
        "value": "(HealthCheck)"
      }
    },
    "postActions": [
      {
        "actionId": "210D431B-A78B-4D2F-B762-4ED3E3EA9025",
        "condition": "(!SkipRestore)",
        "continueOnError": true,
        "description": "Restore NuGet packages required by this project.",
        "manualInstructions": [
          { "text": "Run 'dotnet restore' in the directory the template was created in." }
        ]
      }
    ]  
}